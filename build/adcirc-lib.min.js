// https://github.com/atdyer/adcirc-lib Version 0.0.1. Copyright 2017 Tristan Dyer.
(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.adcirc=e.adcirc||{})})(this,function(e){"use strict";function t(e){function t(e,t,n){var o=n.slice(e,e+t);a.onload=r,a.readAsText(o)}function r(r){if(null!==r.target.error)throw f(r.target.error),r.target.error;var n=r.target.result;s+=n.length,s>=o?(c(n),l()):(c(n),u()?t(s,i,e):l())}var n=e,o=e.size,a=new FileReader,i=262144,s=0,c=function(){},u=function(){return!0},l=function(){},f=function(){},d=function(e){n=e,o=e.size};return d.read=function(){return t(s,i,e),d},d.read_block=function(e,t,r){var o=n.slice(e,t);a.onload=function(e){if(null!==e.target.error)throw f(e.target.error),e.target.error;r(e.target.result)},a.readAsText(o)},d.block_size=function(e){return arguments.length?(i=e,d):i},d.offset=function(e){return arguments.length?(s=e,d):s},d.block_callback=function(e){return arguments.length?("function"==typeof e&&(c=e),d):c},d.continue_callback=function(e){return arguments.length?("function"==typeof e&&(u=e),d):u},d.finished_callback=function(e){return arguments.length?("function"==typeof e&&(l=e),d):l},d.error_callback=function(e){return arguments.length?("function"==typeof e&&(f=e),d):f},d}function build_fort14_worker(){function e(){var e;if(X&&N.length)for(;void 0!==(e=N.shift());)e();if(H&&Z.length)for(;void 0!==(e=Z.shift());)e()}function r(){a("\n"),l(),e()}function n(e,t){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(n,e[n]);return new t(r)}function o(e){p(e)}function a(e){F=0,e=I+e;for(var t,r;null!==(r=S.exec(e));)100*(L+r.index)/g>V&&(u(V),V+=q),0==R?(B.agrid=L+r.index,m=r[0].trim()):1==R?(B.info_line=L+r.index,h=r[0].trim(),t=h.match(U),y=parseInt(t[0]),v=parseInt(t[1]),x=new Float32Array(3*v),b=new Uint32Array(3*y)):R>=2&&R<2+v?(2==R&&(B.nodes=L+r.index),i(r[0])):R>=2+v&&R<2+v+y?(X=!0,R==2+v&&(B.elements=L+r.index),s(r[0])):void 0===w?(H=!0,B.nope=L+r.index,t=r[0].match(U),w=parseInt(t[0])):void 0===A?(B.neta=L+r.index,t=r[0].match(U),A=parseInt(t[0])):C.length==w&&void 0===E?(B.nbou=L+r.index,t=r[0].match(U),E=parseInt(t[0])):C.length==w&&void 0===k?(B.nvel=L+r.index,t=r[0].match(U),k=parseInt(t[0])):Y==-1&&(C.length<w||D.length<E)?(t=r[0].match(U),Y=parseInt(t[0]),K=[]):K.length<Y&&(t=r[0].match(U),K.push(parseInt(t[0])),K.length==Y&&(C.length<w?C.push(K):D.length<E&&D.push(K),Y=-1,K=[])),F=S.lastIndex,R+=1;I=e.slice(F),L+=F}function i(e){var t=e.match(U),r=parseInt(t[0]),n=parseFloat(t[1]),o=parseFloat(t[2]),a=parseFloat(t[3]);n<P?P=n:n>z&&(z=n),o<T?T=o:o>O&&(O=o),a<j?j=a:a>M&&(M=a);var i=R-2;x[3*i]=n,x[3*i+1]=o,x[3*i+2]=a,W[r]=i}function s(e){var t=e.match(U),r=R-v-2,n=parseInt(t[0]);b[3*r]=parseInt(t[2]),b[3*r+1]=parseInt(t[3]),b[3*r+2]=parseInt(t[4]),G[n]=r}function c(){self.postMessage({type:"start"})}function u(e){self.postMessage({type:"progress",progress:e})}function l(){self.postMessage({type:"finish"})}function f(){var e=n(G,Uint32Array),t={type:"elements",element_array:b.buffer,element_map:e.buffer};self.postMessage(t,[t.element_array,t.element_map])}function d(){var e=n(W,Uint32Array),t={type:"nodes",node_array:x.buffer,node_map:e.buffer,dimensions:3};self.postMessage(t,[t.node_array,t.node_map])}function p(e){self.postMessage({type:"error",error:e.message})}var _,g,m,h,v,y,x,b,w,A,E,k,F=0,L=0,R=0,B={},I="",S=/.*\r?\n/g,U=/\S+/g,P=1/0,z=-(1/0),T=1/0,O=-(1/0),j=1/0,M=-(1/0),W={},G={},C=[],D=[],Y=-1,K=[],X=!1,H=!1,N=[],Z=[],q=2,V=0+q;self.addEventListener("message",function(n){switch(n=n.data,n.type){case"read":g=n.file.size,c(),_=t(n.file).block_callback(a).finished_callback(r).error_callback(o).read();break;case"get":"nodes"===n.what&&(N.push(d),e()),"elements"===n.what&&(Z.push(f),e())}})}function r(){var e="";return e+=t.toString(),e+=build_fort14_worker.toString(),e+="build_fort14_worker();",U(e)}function n(e){for(var t=d3.map(),r=e.length/2,n=0;n<r;++n)t.set(e[2*n],e[2*n+1]);return t}function o(e){e=e||Object.create(null);var t={},r={};return e.on=function(r,n){return arguments.length?1==arguments.length?t[r]:(void 0===t[r]&&(t[r]=[]),t[r].indexOf(n)===-1&&t[r].push(n),e):e},e.once=function(t,n){return arguments.length?1==arguments.length?r[t]:(void 0===r[t]&&(r[t]=[]),r[t].indexOf(n)===-1&&r[t].push(n),e):e},e.off=function(n,o){var a,i=t[n],s=r[n];return void 0!==i&&(a=i.indexOf(o))!==-1&&i.splice(a,1),void 0!==s&&(a=s.indexOf(o))!==-1&&s.splice(a,1),e},e.dispatch=function(n){var o,a,i=t[n.type],s=r[n.type],c=[];if(void 0!==i){for(n.target=e,a=i.length,o=0;o<a;o++)c[o]=i[o];for(o=0;o<a;o++)c[o].call(e,n)}if(void 0!==s){for(n.target=e,a=s.length,o=0;o<a;o++)c[o]=s[o];for(o=0;o<a;o++)c[o].call(e,n);r[n.type]=[]}return e},e}function a(){var e,t,a=r(),i=o();return i.elements=function(t){return arguments.length?(e=t,i):e},i.nodes=function(e){return arguments.length?(t=e,i):t},i.read=function(e){a.postMessage({type:"read",file:e})},a.addEventListener("message",function(r){switch(r=r.data,r.type){case"start":i.dispatch({type:"start"});break;case"progress":i.dispatch({type:"progress",progress:r.progress});break;case"finish":i.dispatch({type:"finish"}),a.postMessage({type:"get",what:"nodes"}),a.postMessage({type:"get",what:"elements"});break;case"nodes":t={array:new Float32Array(r.node_array),map:n(new Uint32Array(r.node_map)),dimensions:r.dimensions,names:["x","y","depth"]},i.dispatch({type:"nodes",nodes:t}),t&&e&&i.dispatch({type:"ready"});break;case"elements":e={array:new Uint32Array(r.element_array),map:n(new Uint32Array(r.element_map))},i.dispatch({type:"elements",elements:e}),t&&e&&i.dispatch({type:"ready"})}}),i}function build_fortnd_worker(){function e(){var e=E.shift();e?(A=!0,e()):A=!1}function r(t){if(t<y){var r=F[t],n=k[r],o=t==y-1?g:k[F[t+1]];_.read_block(n,o,function(r){u(t,i(r)),e()})}}function n(e){g=e.size,l(),_=t(e).error_callback(s),_.read_block(0,1024,a)}function o(e){function t(e){e=s+e;for(var u,l=/.*\r?\n/g,p=0,g=1;null!==(u=l.exec(e));){var m=u[0].match(/\S+/g);if(m&&m.length>=2){if(a){var h=u[0].length*x;o=o-s.length+u.index+h,r+=1,n=F[r],i=!0,a=!1;break}parseFloat(m[1])==n?(a=!0,k[n]=o-s.length+u.index,f(r/y*100)):g=parseInt(m[0])}p=l.lastIndex}s="",i?i=!1:g<x/2?(o-=c,s=""):(o+=c,s=e.slice(p)),r<y?_.read_block(o,o+c,t):d()}var r=0,n=F[r],o=e,a=!1,i=!1,s="",c=65536;_.read_block(o,o+c,t)}function a(e){var t=/.*\r?\n/g,r=0,n=t.exec(e);if(null!==n&&(m=n[0],r+=n[0].length,null!==(n=t.exec(e)))){h=n[0],r+=n[0].length;var a=h.match(/\S+/g);y=parseInt(a[0]),x=parseInt(a[1]),w=parseInt(a[3]),b=parseFloat(a[2])/w;for(var i=0;i<y;++i)F.push((i+1)*w);c(),o(r)}}function i(e){for(var t,r,n,o=/.*\r?\n/g,a={array:new Float32Array(v*x),min:new Array(v).fill(1/0),max:new Array(v).fill(-(1/0))},i=0;null!==(t=o.exec(e));)if(0==i)r=t[0].match(/\S+/g),a.model_time=parseFloat(r[0]),a.timestep=parseInt(r[1]),i+=1;else{r=t[0].match(/\S+/g);for(var s=0;s<v;++s)n=parseFloat(r[1]),a.array[i++-1]=n,n!==-99999&&(n<a.min[s]?a.min[s]=n:n>a.max[s]&&(a.max[s]=n))}return a}function s(e){p(e)}function c(){self.postMessage({type:"info",file_size:g,num_datapoints:x,num_datasets:y,num_dimensions:v,model_timestep:b,model_timestep_interval:w})}function u(e,t){for(var r=[],n=0;n<v;++n)r.push([t.min[n],t.max[n]]);var o={type:"timestep",data_range:r,dimensions:v,index:e,model_time:t.model_time,model_timestep:t.timestep,array:t.array.buffer};self.postMessage(o,[o.array])}function l(){self.postMessage({type:"start"})}function f(e){self.postMessage({type:"progress",progress:e})}function d(){self.postMessage({type:"finish"})}function p(e){self.postMessage({type:"error",error:e.message})}var _,g,m,h,v,y,x,b,w,A=!1,E=[],k={},F=[];self.addEventListener("message",function(t){switch(t=t.data,t.type){case"n_dims":v=t.n_dims;break;case"read":n(t.file);break;case"timestep":E.push(function(){r(t.index)}),A||e()}})}function i(){var e="";return e+=t.toString(),e+=build_fortnd_worker.toString(),e+="build_fortnd_worker();",U(e)}function s(e){var t,r,n,o,a,i,s={};if(e.hasOwnProperty("data_range")&&e.hasOwnProperty("dimensions")&&e.hasOwnProperty("model_time")&&e.hasOwnProperty("model_timestep")&&e.hasOwnProperty("index")&&e.hasOwnProperty("array"))try{r=e.data_range,n=e.dimensions,o=e.index,a=e.model_time,i=e.model_timestep,t=new Float32Array(e.array)}catch(e){throw console.error("Error building timestep"),console.error(e.message),e}else console.error("Timestep is missing data"),console.error(e);return s.data=function(){return t},s.data_range=function(){return r},s.dimensions=function(){return n},s.index=function(e){return arguments.length?(o=e,s):o},s.model_time=function(e){return arguments.length?(a=e,s):a},s.model_timestep=function(e){return arguments.length?(i=e,s):i},s}function c(e){var t,r,n,a,c,u,l=e,f=i(),d=o();return d.timestep=function(e,t){return e>=0&&e<n&&("function"==typeof t&&d.once("timestep"+e,function(e){t(e)}),f.postMessage({type:"timestep",index:e})),d},d.read=function(e){return f.postMessage({type:"read",file:e}),d},f.addEventListener("message",function(e){switch(e=e.data,e.type){case"info":t=e.file_size,r=e.num_datapoints,n=e.num_datasets,a=e.num_dimensions,c=e.model_timestep,u=e.model_timestep_interval,d.dispatch({type:"info",file_size:t,num_datapoints:r,num_datasets:n,num_dimensions:a,model_timestep:c,model_timestep_interval:u});break;case"start":d.dispatch({type:"start"});break;case"progress":d.dispatch({type:"progress",progress:e.progress});break;case"finish":d.dispatch({type:"finish"}),d.dispatch({type:"ready"});break;case"timestep":var o=s(e);d.dispatch({type:"timestep",timestep:o}),d.dispatch({type:"timestep"+o.index(),timestep:o})}}),f.postMessage({type:"n_dims",n_dims:l}),d}function u(){return c(1)}function l(){return c(2)}function f(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=e.getExtension("WEBGL_compressed_texture_etc1");break;default:n=e.getExtension(r)}return null===n&&console.warn("WebGL: "+r+" extension not supported."),t[r]=n,n}}}function d(e){return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}function p(){function e(){for(var e=0;e<16;++e)r[e]=n[e];return r}function t(){for(var e=0;e<16;++e)n[e]=r[e];return n}var r=new Float32Array(16).fill(0),n=new Float32Array(16);return r[0]=r[5]=r[10]=r[15]=1,r.identity=function(){return r.fill(0),r[0]=r[5]=r[10]=r[15]=1,r},r.ortho=function(e,t,n,o,a,i){return r[0]=2/(t-e),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(o-n),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=-1/(i-a),r[11]=0,r[12]=(t+e)/(e-t),r[13]=(o+n)/(n-o),r[14]=-a/(a-i),r[15]=1,r},r.scale=function(t,o,a){return n[0]=t*r[0],n[1]=t*r[1],n[2]=t*r[2],n[3]=t*r[3],n[4]=o*r[4],n[5]=o*r[5],n[6]=o*r[6],n[7]=o*r[7],n[8]=a*r[8],n[9]=a*r[9],n[10]=a*r[10],n[11]=a*r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],e(),r},r.translate=function(o,a,i){return t(),n[12]=r[0]*o+r[4]*a+r[8]*i+r[12],n[13]=r[1]*o+r[5]*a+r[9]*i+r[13],n[14]=r[2]*o+r[6]*a+r[10]*i+r[14],n[15]=r[3]*o+r[7]*a+r[11]*i+r[15],e()},r}function _(e){function t(e){c.dispatch(e)}function r(){(a()||E)&&(E=!1,n()),requestAnimationFrame(r)}function n(){g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);for(var e=0;e<k.length;++e)k[e].render()}function a(){return(l.clientWidth!==v||l.clientHeight!==y)&&(v=l.clientWidth,y=l.clientHeight,l.width=v*x,l.height=y*x,g.viewport(0,0,v,y),(!h||h<0)&&(h=y),i(),!0)}function i(e,t,r){if(!arguments.length){var n=d3.zoomTransform(l);return i(n.k,n.x,n.y)}w.ortho(0,v,y,0,-1e4,1e4).translate(t,r,0).scale(e,-e,1).translate(0,-h,0);for(var o=0;o<k.length;++o)k[o].shader().projection(w)}function s(){var e=d3.event.transform;i(e.k,e.x,e.y),c.render()}var c=o(),u=e,l=e.node();if(d(l)){var _={alpha:!1,antialias:!1,premultiplieAlpha:!1,stencil:!0},g=l.getContext("webgl",_)||l.getContext("experimental-webgl",_);if(null!==g){var m=f(g);m.get("ANGLE_instanced_arrays"),m.get("OES_element_index_uint"),m.get("OES_standard_derivatives");var h,v=0,y=0,x=1,b=d3.color("white"),w=p(),A=d3.zoom().on("zoom",s);u.call(A);var E=!0,k=[];return c.add_view=function(e){return e.on("update",c.render),k.push(e),i(),c},c.clear_color=function(e){return arguments.length?(b=d3.rgb.apply(b,arguments),g.clearColor(b.r/255,b.g/255,b.b/255,b.opacity),c.render()):b},c.gl_context=function(){return g},c.remove_view=function(e){return e.off("update",c.render),c},c.render=function(){return E=!0,c},c.zoom_to=function(e){if(!arguments.length)return c;var t=e.bounding_box(),r=0,n=t[1][0]-t[0][0],o=t[1][1]-t[0][1],a=(t[0][0]+t[1][0])/2,i=y-(t[0][1]+t[1][1])/2,s=.9/Math.max(n/v,o/y),l=[v/2-s*a,y/2-s*i];return 2==arguments.length&&(r=arguments[1]),u.transition().duration(r).call(A.transform,d3.zoomIdentity.translate(l[0],l[1]).scale(s)),c},l.addEventListener("webglcontextlost",t),l.addEventListener("webglcontextrestored",t),l.addEventListener("webglcontextcreationerror",t),r(),c}}}function g(e,t){function r(e){for(var t=new Float32Array(3*s),r=0;r<s;++r){var n=e[r];t[3*r]=n,t[3*r+1]=n,t[3*r+2]=n}var o=u.get("vertex_value");a.bindBuffer(a.ARRAY_BUFFER,o.buffer),a.bufferSubData(a.ARRAY_BUFFER,0,t)}function n(e){for(var t=new Float32Array(3*s),r=i.nodes().map,n=i.elements().array,o=0;o<3*s;++o){var c=n[o],l=r.get(c);t[o]=e[l]}var f=u.get("vertex_value");a.bindBuffer(a.ARRAY_BUFFER,f.buffer),a.bufferSubData(a.ARRAY_BUFFER,0,t)}var a=e,i=t,s=0,c=0,u=d3.map(),l=o();return l.bind_buffer=function(e){var t=u.get(e);if(t)return a.bindBuffer(a.ARRAY_BUFFER,t.buffer),t},l.bounding_box=function(){return i.bounding_box()},l.drawArrays=function(){a.drawArrays(a.TRIANGLES,0,3*s)},l.elemental_value=function(e){var t=i.elemental_value(e);t&&(r(t),l.dispatch({type:"update",value:e}))},l.nodal_value=function(e){var t=i.nodal_value(e);t&&(n(t),l.dispatch({type:"update",value:e}))},function(e,t){c=t.array.length,s=t.array.length/3;for(var r=new Float32Array(2*c),n=new Float32Array(c),o=new Float32Array(3*c),i=e.dimensions,l=0;l<c;++l){var f=t.array[l],d=e.map.get(f);r[2*l]=e.array[i*d],r[2*l+1]=e.array[i*d+1]}for(var l=0;l<s;++l)o[9*l]=1,o[9*l+4]=1,o[9*l+8]=1;var p=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,p),a.bufferData(a.ARRAY_BUFFER,r,a.STATIC_DRAW);var _=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,_),a.bufferData(a.ARRAY_BUFFER,n,a.DYNAMIC_DRAW);var g=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,g),a.bufferData(a.ARRAY_BUFFER,o,a.STATIC_DRAW),u.set("vertex_position",{buffer:p,size:2,type:a.FLOAT,normalized:!1,stride:0,offset:0}),u.set("vertex_value",{buffer:_,size:1,type:a.FLOAT,normalized:!1,stride:0,offset:0}),u.set("vertex_normal",{buffer:g,size:3,type:a.FLOAT,normalized:!1,stride:0,offset:0})}(i.nodes(),i.elements()),l}function m(e,t,r){var n=e,a=t,i=r,s=o();return s.elemental_value=function(e){return a.elemental_value(e),s},s.nodal_value=function(e){return a.nodal_value(e),s},s.render=function(){return i.use(),i.attributes().each(function(e,t){var r=a.bind_buffer(t);"undefined"!==r&&(n.vertexAttribPointer(e,r.size,r.type,r.normalized,r.stride,r.offset),n.enableVertexAttribArray(e))}),a.drawArrays(),s},s.shader=function(e){return arguments.length?(e.projection(i.projection()),i=e,s.dispatch({type:"update"}),s):i},a.on("update",s.dispatch),s}function h(e,t,r,n,o){var a=e.createShader(t);if(e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)===!1){var i=e.getShaderInfoLog(a);return o||(o=console.error),o("Unable to compile shader"),o(i),void e.deleteShader(a)}return e.getShaderParameter(a,e.COMPILE_STATUS)===!1&&(n||(n=console.warn),n(e.getShaderInfoLog(a),v(r))),a}function v(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}function y(e,t,r,n,o){var a=e.createProgram(),i=h(e,e.VERTEX_SHADER,t,n,o),s=h(e,e.FRAGMENT_SHADER,r,n,o);if(a&&i&&s)return e.attachShader(a,i),e.attachShader(a,s),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)===!1&&(o||(o=console.error),o(e.getProgramInfoLog(a))),e.deleteShader(i),e.deleteShader(s),a}function x(e){var t=e,r=y(t,b(),w()),n=d3.color("white"),o=d3.color("black"),a=.3,i=1;t.useProgram(r);var s=d3.map({vertex_normal:t.getAttribLocation(r,"vertex_normal"),vertex_position:t.getAttribLocation(r,"vertex_position")}),c=d3.map({face_color:t.getUniformLocation(r,"face_color"),projection_matrix:t.getUniformLocation(r,"projection_matrix"),wire_alpha:t.getUniformLocation(r,"wire_alpha"),wire_color:t.getUniformLocation(r,"wire_color"),wire_width:t.getUniformLocation(r,"wire_width")});return r.attribute=function(e){return s.get(e)},r.attributes=function(e){return arguments.length?(s.each(e),r):s},r.face_color=function(e){return arguments.length?(n=e,t.useProgram(r),t.uniform3fv(r.uniform("face_color"),[e.r/255,e.g/255,e.b/255]),r):n},r.set_projection=function(e){return t.useProgram(r),t.uniformMatrix4fv(r.uniform("projection_matrix"),!1,e),r},r.wire_alpha=function(e){return arguments.length?(a=e,t.useProgram(r),t.uniform1f(r.uniform("wire_alpha"),e),r):a},r.wire_color=function(e){return arguments.length?(o=e,t.useProgram(r),t.uniform3fv(r.uniform("wire_color"),[e.r/255,e.g/255,e.b/255]),r):o},r.wire_width=function(e){return arguments.length?(i=e,t.useProgram(r),t.uniform1f(r.uniform("wire_width"),e),r):i},r.uniform=function(e){return c.get(e)},r.uniforms=function(){return c.keys()},r.use=function(){return t.useProgram(r),r},r.face_color(r.face_color()).wire_alpha(r.wire_alpha()).wire_color(r.wire_color()).wire_width(r.wire_width())}function b(){return["attribute vec3 vertex_position;","attribute vec3 vertex_normal;","uniform mat4 projection_matrix;","varying vec3 _vertex_normal;","void main( void ) {","   gl_Position = projection_matrix * vec4( vertex_position, 1.0 );","   _vertex_normal = vertex_normal;","}"].join("\n")}function w(){return["#extension GL_OES_standard_derivatives : enable","precision highp float;","varying vec3 _vertex_normal;","uniform vec3 face_color;","uniform vec3 wire_color;","uniform float wire_alpha;","uniform float wire_width;","float edgeFactorTri() {","   vec3 d = fwidth( _vertex_normal.xyz );","   vec3 a3 = smoothstep( vec3( 0.0 ), d * wire_width, _vertex_normal.xyz );","   return min( min( a3.x, a3.y ), a3.z );","}","void main() {","   vec4 wire = mix( vec4(face_color, 1.0), vec4(wire_color, 1.0), wire_alpha);","   gl_FragColor = mix( wire, vec4(face_color, 1.0), edgeFactorTri() );","}"].join("\n")}function A(e,t,r,n){for(var o,a=e,i=y(a,E(t),k()),s=[],c=[],u=d3.color("black"),l=.3,f=1,r=r||0,n=n||1,d=0;d<t;++d)c.push(r+(n-r)*d/(t-1)),s.push(d3.color(d3.schemeCategory20[d%t]));a.useProgram(i);var p=d3.map({vertex_normal:a.getAttribLocation(i,"vertex_normal"),vertex_position:a.getAttribLocation(i,"vertex_position"),vertex_value:a.getAttribLocation(i,"vertex_value")}),_=d3.map({gradient_colors:a.getUniformLocation(i,"gradient_colors"),gradient_stops:a.getUniformLocation(i,"gradient_stops"),projection_matrix:a.getUniformLocation(i,"projection_matrix"),wire_alpha:a.getUniformLocation(i,"wire_alpha"),wire_color:a.getUniformLocation(i,"wire_color"),wire_width:a.getUniformLocation(i,"wire_width")});return i.attribute=function(e){return p.get(e)},i.attributes=function(e){return arguments.length?(p.each(e),i):p},i.gradient_colors=function(e){if(!arguments.length)return s;s=e;var t=s.map(function(e){return[e.r/255,e.g/255,e.b/255]}).reduce(function(e,t){return e.concat(t)},[]);return a.useProgram(i),a.uniform3fv(i.uniform("gradient_colors"),t),i},i.gradient_stops=function(e){return arguments.length?(c=e,a.useProgram(i),a.uniform1fv(i.uniform("gradient_stops"),c),i):c},i.projection=function(e){return arguments.length?(o=e,a.useProgram(i),a.uniformMatrix4fv(i.uniform("projection_matrix"),!1,e),i):o},i.wire_alpha=function(e){return arguments.length?(l=e,a.useProgram(i),a.uniform1f(i.uniform("wire_alpha"),e),i):l},i.wire_color=function(e){return arguments.length?(u=e,a.useProgram(i),a.uniform3fv(i.uniform("wire_color"),[e.r/255,e.g/255,e.b/255]),i):u},i.wire_width=function(e){return arguments.length?(f=e,a.useProgram(i),a.uniform1f(i.uniform("wire_width"),e),i):f},i.uniform=function(e){return _.get(e)},i.uniforms=function(){return _.keys()},i.use=function(){return a.useProgram(i),i},i.gradient_colors(i.gradient_colors()).gradient_stops(i.gradient_stops()).wire_alpha(i.wire_alpha()).wire_color(i.wire_color()).wire_width(i.wire_width())}function E(e){for(var t=["attribute vec2 vertex_position;","attribute vec3 vertex_normal;","attribute float vertex_value;","uniform mat4 projection_matrix;","uniform float gradient_stops["+e+"];","uniform vec3 gradient_colors["+e+"];","varying vec3 _vertex_normal;","varying vec3 _vertex_color;","void main() {","  gl_Position = projection_matrix * vec4( vertex_position, vertex_value, 1.0 );","  _vertex_normal = vertex_normal;","  _vertex_color = gradient_colors[0];","  float t;"],r=1;r<e;++r)t.push("  t = clamp((vertex_value - gradient_stops["+(r-1)+"]) / (gradient_stops["+r+"]-gradient_stops["+(r-1)+"]), 0.0, 1.0);"),t.push("  _vertex_color = mix( _vertex_color, gradient_colors["+r+"], t*t*(3.0-2.0*t));");return t.push("}"),t.join("\n")}function k(){return["#extension GL_OES_standard_derivatives : enable","precision mediump float;","varying vec3 _vertex_normal;","varying vec3 _vertex_color;","uniform vec3 wire_color;","uniform float wire_alpha;","uniform float wire_width;","float edgeFactorTri() {","   vec3 d = fwidth( _vertex_normal.xyz );","   vec3 a3 = smoothstep( vec3( 0.0 ), d * wire_width, _vertex_normal.xyz );","   return min( min( a3.x, a3.y ), a3.z );","}","void main() {","   vec4 wire = mix( vec4(_vertex_color, 1.0), vec4(wire_color, 1.0), wire_alpha);","   gl_FragColor = mix( wire, vec4(_vertex_color, 1.0), edgeFactorTri() );","}"].join("\n")}function F(){function e(e){return e%c}function t(t){p[e(t)]=!1,--m}function r(){return void 0===c||void 0===s?(console.error("Cache sizes not defined"),!1):!!(void 0!==a&&void 0!==i||l)||(console.error("A getter must be defined if cache is not bounded by other caches"),!1)}function n(t){p[e(t)]=!0,++m,g.is_full()&&g.dispatch({type:"ready"})}var a,i,s,c,u,l,f,d,p,_,g=o(),m=0;return g.cache_left=function(e){return arguments.length?(a=e,g):a},g.cache_right=function(e){return arguments.length?(i=e,g):i},g.contains=function(e){return e>=_&&e<_+c},g.get=function(t){if(!r())return void console.error("Cache has not been properly initialized");if(g.valid(t))return d[e(t)];if(t<0||t>=s)return void console.error(t+" is outside allowable range");if(t!=_-1){if(t!=_+c)console.error("Jumps not yet supported. Coming soon...");else if(g.shift_right())return d[e(t)]}else if(g.shift_left())return d[e(t)]},g.getter=function(e){return arguments.length?("function"==typeof e?(u=e,l=!0):console.error("Getter must be a function"),g):u},g.is_full=function(){return m==c},g.max_size=function(e){return arguments.length?(s=e,g):s},g.print=function(){console.log(d)},g.range=function(e){if(!arguments.length)return[_,_+c];if(!r())return void console.error("Cache not yet initialized. Set size and accessors before range");if(e[1]-e[0]!==c)return void console.error("Invalid range for cache of size "+c);_=e[0];for(var t=_;t<_+c;++t)a&&a.contains(t)?g.set(t,a.get(t)):i&&i.contains(t)?g.set(t,i.get(t)):u(t,g.set);return g},g.set=function(t,r){g.contains(t)?(d[e(t)]=f(e(t),r),n(t)):console.warn("Dataset "+t+" does not fall into the cache range")},g.size=function(e){return arguments.length?(c=e,d&&console.warn("Warning: Resizing cache, all data will be lost"),d=new Array(c),p=new Array(c).fill(!1),m=0,g):c},g.transform=function(e){return arguments.length?("function"==typeof e&&(f=e),g):f},g.shift_left=function(){var e,r=_-1;return!(r<0)&&(a&&(_==a.range()[1]?e=a.take_right():a.valid(r)&&(e=a.get(r))),i&&(_+c==i.range()[0]?a&&i.range()[0]!==a.range()[1]&&i.shift_left():i.valid(r)&&(e=i.get(r))),!(void 0===e&&!l)&&(_=r,t(_),void 0!==e?g.set(r,e):u(r,g.set),!0))},g.shift_right=function(){var e,r=_+c;return!(r>=s)&&(i&&(r==i.range()[0]?e=i.take_left():i.valid(r)&&(e=i.get(r))),a&&(_==a.range()[1]?i&&i.range()[0]!==a.range()[1]&&a.shift_right():a.valid(r)&&(e=a.get(r))),!(void 0===e&&!l)&&(_+=1,t(r),i?g.set(r,e):u(r,g.set),!0))},g.take_left=function(){var t,r=_;return p[e(r)]&&(t=d[e(r)],g.shift_right()),t},g.take_right=function(){var t,r=_+c-1;return p[e(r)]&&(t=d[e(r)],g.shift_left()),t},g.valid=function(t){return g.contains(t)&&p[e(t)]},f=function(e,t){return t},u=function(){console.error("A getter has not been defined for this cache.")},g}function L(){function e(t){return c=t.style("position","relative").style("width","100%").style("margin-top","4px").style("margin-bottom","4px").style("user-select","none"),u=c.selectAll("div").data(["slider_bar"]),u.exit().remove(),u=u.enter().append("div").merge(u),u.style("position","relative").style("left",0).style("width","1px").style("background-clip","content-box").style("margin","-4px").style("border-width","4px").style("border-style","solid").style("user-select","none"),l=c.node().getBoundingClientRect().width,E.domain([0,l]),c.on("mousedown",r).on("wheel",i),e.arrows(f),e.bar(d),e.color(p),e.domain([0,100]),e.draggable(v),e.height(g),e.jumpable(y),e}function t(e){var t=A.domain();return e<t[0]?t[0]:e>t[1]?t[1]:e}function r(){if(y){var e=d3.mouse(this)[0];e<0&&(e=0),e>l&&(e=l);s(E(e))&&n()}}function n(){e.dispatch({type:"value",value:_})}function a(){if(v){var e=d3.event.x;e<0&&(e=0),e>l&&(e=l);s(E(e))&&n()}}function i(){if(v){var t=d3.event.shiftKey?10*b:b,r=d3.event.deltaX<0||d3.event.deltaY<0?1:-1;s(e.current()+t*r)&&n()}}function s(e){return(e=x?t(e):w(e))!==_&&(_=y?e:e>_?_+b:_-b,u&&u.style("left",A(_)+"%"),!0)}var c,u,l,f="both",d="dimgray",p="lightgray",_=0,g=20,m=d3.drag().on("drag",a),h=d3.drag().on("start",r).on("drag",a),v=!0,y=!0,x=!1,b=1,w=d3.scaleQuantize(),A=d3.scaleLinear().range([0,100]).clamp(!0),E=d3.scaleLinear();return e.arrows=function(t){if(!arguments.length)return f;if(("top"==t||"bottom"==t||"both"==t||"none"==t)&&(f=t,u))switch(f){case"both":u.style("border-color",d+" transparent "+d+" transparent");break;case"top":u.style("border-color",d+" transparent transparent transparent");break;case"bottom":u.style("border-color","transparent transparent "+d+" transparent");break;default:u.style("border-color","transparent transparent transparent transparent")}return e},e.bar=function(t){return arguments.length?(d=t,u&&(u.style("background-color",d),e.arrows(f)),e):d},e.color=function(t){return arguments.length?(p=t,c&&c.style("background-color",p),e):p},e.continuous=function(t){return arguments.length?(x=!!t,e):x},e.current=function(t){return arguments.length?(s(t),e):_},e.domain=function(t){if(!arguments.length)return A.domain();var r=[];b=2==arguments.length?arguments[1]:1;for(var n=t[0];n<=t[1];n+=b)r.push(n);return w.domain(t).range(r),A.domain(t),E.range(t),e},e.draggable=function(t){return arguments.length?(v=!!t,u&&(v?u.style("cursor","pointer").call(m):u.style("cursor",null).on(".drag",null)),e):v},e.height=function(t){return arguments.length?(g=t,c&&c.style("min-height",g+"px"),u&&u.style("min-height",g+"px"),e):g},e.jumpable=function(t){return arguments.length?(y=!!t,c&&(y?c.style("cursor","pointer").call(h):c.style("cursor",null).on(".drag",null)),e):y},o(e)}function R(){function e(r){return t=r,e.file_picker(n),e}var t,r,n;return e.file_picker=function(o){return arguments.length?"function"!=typeof o?e:(n=o,!r&&t&&(r=t.append("input").attr("type","file").style("display","none").on("click",function(){d3.event.stopPropagation()}).on("change",function(){"function"==typeof n&&n(r.node().files[0])})),t&&t.on("click",function(){d3.event.preventDefault(),r.node().click()}),e):r},e}function B(e){function t(e){return e.append("div").style("display","flex").style("flex-direction","column")}function r(){console.error("All UI components must have a unique ID")}var n=Object.create(null);return e.selectAll(".adc-slider").each(function(){var e=d3.select(this),o=e.attr("id");if(!o||n[o])return r();n[o]=L()(t(e))}),e.selectAll(".adc-button").each(function(){var e=d3.select(this),t=e.attr("id");if(!t||n[t])return r();n[t]=R()(e)}),n}function I(){function e(e){for(var o=e.names?Math.min(e.names.length,e.dimensions)-2:0,a=e.array.length/e.dimensions,i=[new Float32Array(2*a)],s=0;s<o;++s)i.push(new Float32Array(a));for(var c=0;c<a;++c){i[0][2*c]=e.array[e.dimensions*c],i[0][2*c+1]=e.array[e.dimensions*c+1];for(var u=0;u<o;++u)i[1+u][c]=e.array[e.dimensions*c+2+u]}n={array:i[0],map:e.map,dimensions:2,names:["x","y"]};for(var u=0;u<o;++u){var l=e.names[2+u];r.nodal_value(l,i[1+u])}t=S(n)}var t,r=o(),n=Object.create({array:[],map:d3.map(),dimensions:2}),a=Object.create({array:[],map:d3.map()}),i=Object.create(null),s=Object.create(null);return r.bounding_box=function(){return t},r.bounds=function(e){var t=r.nodal_value(e)||r.elemental_value(e);if(t)return S({array:t,dimensions:1})},r.elemental_value=function(e,t){return 1==arguments.length?s[e]:(2==arguments.length&&t.length==a.array.length/3&&(s[e]=t,r.dispatch({type:"elemental_value",name:e,array:t})),r)},r.elements=function(e){return arguments.length?(e.array&&e.map&&(a=e),r):a},r.nodal_value=function(e,t){return 1==arguments.length?i[e]:(2==arguments.length&&t.length==n.array.length/n.dimensions&&(i[e]=t,r.dispatch({type:"nodal_value",name:e,array:t})),r)},r.nodes=function(t){return arguments.length?(t.array&&t.map&&t.dimensions&&e(t),r):n},r.num_elements=function(){return a.array.length/3},r.num_nodes=function(){return n.array.length/n.dimensions},r}function S(e){for(var t=e.array,r=e.dimensions,n=t.length/r,o=[],a=[],i=0;i<r;++i)o.push(1/0),a.push(-(1/0));for(var s=0;s<n;++s)for(var c=0;c<r;++c)t[r*s+c]!==-99999&&(t[r*s+c]<o[c]&&(o[c]=t[r*s+c]),t[r*s+c]>a[c]&&(a[c]=t[r*s+c]));return 1==r?[o[0],a[0]]:[o,a]}var U=function(e){var t=URL.createObjectURL(new Blob([e],{type:"application/javascript"})),r=new Worker(t);return URL.revokeObjectURL(t),r};e.fort14=a,e.fort63=u,e.fort64=l,e.gl_renderer=_,e.geometry=g,e.view=m,e.basic_shader=x,e.gradient_shader=A,e.cache=F,e.dispatcher=o,e.slider=L,e.button=R,e.ui=B,e.mesh=I,Object.defineProperty(e,"__esModule",{value:!0})});