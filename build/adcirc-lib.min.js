// https://github.com/atdyer/adcirc-lib Version 0.0.1. Copyright 2017 Tristan Dyer.
(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.adcirc=e.adcirc||{})})(this,function(e){"use strict";function t(e){function t(e,t,r){var o=r.slice(e,e+t);i.onload=n,i.readAsText(o)}function n(n){if(null!==n.target.error)throw f(n.target.error),n.target.error;var r=n.target.result;s+=r.length,s>=o?(c(r),u()):(c(r),l()?t(s,a,e):u())}var r=e,o=e.size,i=new FileReader,a=262144,s=0,c=function(){},l=function(){return!0},u=function(){},f=function(){},d=function(e){r=e,o=e.size};return d.read=function(){return t(s,a,e),d},d.read_block=function(e,t,n){var o=r.slice(e,t);i.onload=function(e){if(null!==e.target.error)throw f(e.target.error),e.target.error;n(e.target.result)},i.readAsText(o)},d.block_size=function(e){return arguments.length?(a=e,d):a},d.offset=function(e){return arguments.length?(s=e,d):s},d.block_callback=function(e){return arguments.length?("function"==typeof e&&(c=e),d):c},d.continue_callback=function(e){return arguments.length?("function"==typeof e&&(l=e),d):l},d.finished_callback=function(e){return arguments.length?("function"==typeof e&&(u=e),d):u},d.error_callback=function(e){return arguments.length?("function"==typeof e&&(f=e),d):f},d}function build_fort14_worker(){function e(){var e;if(X&&N.length)for(;void 0!==(e=N.shift());)e();if(H&&q.length)for(;void 0!==(e=q.shift());)e()}function n(){i("\n"),u("load_mesh"),e()}function r(e,t){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(r,e[r]);return new t(n)}function o(e){p(e)}function i(e){F=0,e=O+e;for(var t,n;null!==(n=B.exec(e));)100*(L+n.index)/h>J&&(l(J,"load_mesh"),J+=Z),0==z?(R.agrid=L+n.index,m=n[0].trim()):1==z?(R.info_line=L+n.index,_=n[0].trim(),t=_.match(I),y=parseInt(t[0]),v=parseInt(t[1]),x=new Float32Array(3*v),b=new Uint32Array(3*y)):z>=2&&z<2+v?(2==z&&(R.nodes=L+n.index),a(n[0])):z>=2+v&&z<2+v+y?(X=!0,z==2+v&&(R.elements=L+n.index),s(n[0])):void 0===w?(H=!0,R.nope=L+n.index,t=n[0].match(I),w=parseInt(t[0])):void 0===A?(R.neta=L+n.index,t=n[0].match(I),A=parseInt(t[0])):G.length==w&&void 0===k?(R.nbou=L+n.index,t=n[0].match(I),k=parseInt(t[0])):G.length==w&&void 0===E?(R.nvel=L+n.index,t=n[0].match(I),E=parseInt(t[0])):-1==Y&&(G.length<w||D.length<k)?(t=n[0].match(I),Y=parseInt(t[0]),K=[]):K.length<Y&&(t=n[0].match(I),K.push(parseInt(t[0])),K.length==Y&&(G.length<w?G.push(K):D.length<k&&D.push(K),Y=-1,K=[])),F=B.lastIndex,z+=1;O=e.slice(F),L+=F}function a(e){var t=e.match(I),n=parseInt(t[0]),r=parseFloat(t[1]),o=parseFloat(t[2]),i=parseFloat(t[3]);r<S?S=r:r>T&&(T=r),o<U?U=o:o>P&&(P=o),i<j?j=i:i>M&&(M=i);var a=z-2;x[3*a]=r,x[3*a+1]=o,x[3*a+2]=i,W[n]=a}function s(e){var t=e.match(I),n=z-v-2,r=parseInt(t[0]);b[3*n]=parseInt(t[2]),b[3*n+1]=parseInt(t[3]),b[3*n+2]=parseInt(t[4]),C[r]=n}function c(e){var t={type:"start"};e&&(t.task=e),self.postMessage(t)}function l(e,t){var n={type:"progress",progress:e};t&&(n.task=t),self.postMessage(n)}function u(e){var t={type:"finish"};e&&(t.task=e),self.postMessage(t)}function f(){var e=r(C,Uint32Array),t={type:"elements",element_array:b.buffer,element_map:e.buffer};self.postMessage(t,[t.element_array,t.element_map])}function d(){var e=r(W,Uint32Array),t={type:"nodes",node_array:x.buffer,node_map:e.buffer,dimensions:3};self.postMessage(t,[t.node_array,t.node_map])}function p(e){self.postMessage({type:"error",error:e.message})}var g,h,m,_,v,y,x,b,w,A,k,E,F=0,L=0,z=0,R={},O="",B=/.*\r?\n/g,I=/\S+/g,S=1/0,T=-1/0,U=1/0,P=-1/0,j=1/0,M=-1/0,W={},C={},G=[],D=[],Y=-1,K=[],X=!1,H=!1,N=[],q=[],Z=2,J=0+Z;self.addEventListener("message",function(r){switch(r=r.data,r.type){case"read":h=r.file.size,c("load_mesh"),g=t(r.file).block_callback(i).finished_callback(n).error_callback(o).read();break;case"get":"nodes"===r.what&&(N.push(d),e()),"elements"===r.what&&(q.push(f),e())}})}function n(){var e="";return e+=t.toString(),e+=build_fort14_worker.toString(),e+="build_fort14_worker();",D(e)}function r(e){for(var t=d3.map(),n=e.length/2,r=0;r<n;++r)t.set(e[2*r],e[2*r+1]);return t}function o(e){e=e||Object.create(null);var t={},n={};return e.on=function(n,r){return arguments.length?1===arguments.length?t[n]:(void 0===t[n]&&(t[n]=[]),-1===t[n].indexOf(r)&&t[n].push(r),e):e},e.once=function(t,r){return arguments.length?1===arguments.length?n[t]:(void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(r)&&n[t].push(r),e):e},e.off=function(r,o){var i,a=t[r],s=n[r];return void 0!==a&&-1!==(i=a.indexOf(o))&&a.splice(i,1),void 0!==s&&-1!==(i=s.indexOf(o))&&s.splice(i,1),e},e.dispatch=function(r){var o,i,a=t[r.type],s=n[r.type],c=[];if(void 0!==a){for(void 0===r.target&&(r.target=e),i=a.length,o=0;o<i;o++)c[o]=a[o];for(o=0;o<i;o++)c[o].call(e,r)}if(void 0!==s){for(void 0===r.target&&(r.target=e),i=s.length,o=0;o<i;o++)c[o]=s[o];for(o=0;o<i;o++)c[o].call(e,r);n[r.type]=[]}return e},e}function i(){var e,t,i=n(),a=o();return a.elements=function(t){return arguments.length?(e=t,a):e},a.nodes=function(e){return arguments.length?(t=e,a):t},a.read=function(e){i.postMessage({type:"read",file:e})},i.addEventListener("message",function(n){switch(n=n.data,n.type){case"start":case"progress":a.dispatch(n);break;case"finish":a.dispatch(n),i.postMessage({type:"get",what:"nodes"}),i.postMessage({type:"get",what:"elements"});break;case"nodes":t={array:new Float32Array(n.node_array),map:r(new Uint32Array(n.node_map)),dimensions:n.dimensions,names:["x","y","depth"]},a.dispatch({type:"nodes",nodes:t}),t&&e&&a.dispatch({type:"ready"});break;case"elements":e={array:new Uint32Array(n.element_array),map:r(new Uint32Array(n.element_map))},a.dispatch({type:"elements",elements:e}),t&&e&&a.dispatch({type:"ready"})}}),a}function build_fortnd_worker(){function e(){var e,t=F;for(F=[];t.length>0;)e=t.shift(),n(e);e=E.shift(),void 0!==e?(k=!0,"timestep"===e.type?i(e.index):"timeseries"===e.type?o(e.node_number):"prep_timeseries"===e.type&&r()):(k=!1,L.finished||s())}function n(e){"timestep"===e.type?e.index<A.length?E.push(e):F.push(e):"timeseries"!==e.type&&"prep_timeseries"!==e.type||(L.finished?E.push(e):F.push(e))}function r(){d("timeseries_prep");for(var t=/\r?\n/g,n=/\S+/g,r=new FileReaderSync,o=r.readAsText(h),i=o.split(t),a=i[1].match(n),s=parseInt(a[1]),c=parseInt(a[0]),u=0;u<s;++u)z[(u+1).toString()]=[];for(var p=0;p<c;++p){var g=2+p*(s+1),m=i[g].match(n);z.seconds.push(parseFloat(m[0])),z.timestep.push(parseInt(m[1]));var _=1/0,v=-1/0;for(f(100*p/b,"timeseries_prep"),u=1;u<s+1;++u){var y=parseFloat(i[g+u].match(n)[1]);-99999!=y&&(y>v&&(v=y),y<_&&(_=y)),z[u.toString()].push(y)}v!=1/0?O.push(v):O.push(null),_!=1/0?R.push(_):R.push(null)}l("timeseries_prep"),e()}function o(t){p({array:new Float32Array(z[t]),node_number:t,min:[R[t-1]],max:[O[t-1]]}),e()}function i(t){function n(t){for(;null!==(r=l.exec(t))&&d<w;){if(a){o=r[0].match(u);for(var p=0;p<v;++p)i=parseFloat(o[1]),f.array[d++]=i,-99999!==i&&(i<f.min[p]?f.min[p]=i:i>f.max[p]&&(f.max[p]=i))}else a=r[0].match(u),f.model_time=parseFloat(a[0]),f.timestep=parseInt(a[1]);s+=r[0].length}d<w?_.read_block(s,s+c,n):(g(f),e())}var r,o,i,a,s=A[t],c=5242880,l=/.*\r?\n/g,u=/\S+/g,f={array:new Float32Array(v*w),index:t,min:new Array(v).fill(1/0),max:new Array(v).fill(-1/0)},d=0;_.read_block(s,s+c,n)}function a(){d(),m=h.size,_=t(h).error_callback(c),_.read_block(0,1024,function(e){var t=/.*\r?\n/g,n=/\S+/g,r=0,o=t.exec(e);if(null!==o&&(r+=o[0].length,null!==(o=t.exec(e)))){r+=o[0].length;var i=o[0],a=i.match(n);b=parseInt(a[0]),w=parseInt(a[1]),x=parseInt(a[3]),y=parseFloat(a[2])/x,u(),L.location=r,s()}})}function s(){function t(t){for(;null!==(n=r.exec(t));)L.header?(L.node_index+=1,L.node_index==w&&(L.header=null,L.node_index=0)):(L.header=n[0],A[L.ts_index++]=L.location,f(L.ts_index/b*100,"map_timesteps")),L.location+=n[0].length;L.ts_index<b?e():(L.finished=!0,l("map_timesteps"),L.final_check||(L.final_check=!0,e()))}var n,r=/.*\r?\n/g;_.read_block(L.location,L.location+L.block_size,t)}function c(e){self.postMessage({type:"error",error:e.message})}function l(e){var t={type:"finish"};e&&(t.task=e),self.postMessage(t)}function u(){self.postMessage({type:"info",file_size:m,num_datapoints:w,num_datasets:b,num_dimensions:v,model_timestep:y,model_timestep_interval:x})}function f(e,t){var n={type:"progress",progress:e};t&&(n.task=t),self.postMessage(n)}function d(e){var t={type:"start"};e&&(t.task=e),self.postMessage(t)}function p(e){for(var t=[],n=0;n<v;++n)t.push([e.min[n],e.max[n]]);var r={type:"timeseries",data_range:t,dimensions:v,node_number:e.node_number,array:e.array.buffer};self.postMessage(r,[r.array])}function g(e){for(var t=[],n=0;n<v;++n)t.push([e.min[n],e.max[n]]);var r={type:"timestep",data_range:t,dimensions:v,index:e.index,model_time:e.model_time,model_timestep:e.timestep,num_datasets:b,array:e.array.buffer};self.postMessage(r,[r.array])}var h,m,_,v,y,x,b=0,w=0,A=[],k=!1,E=[],F=[],L={block_size:10485760,location:0,header:null,ts_index:0,node_index:0,finished:!1,final_check:!1},z={seconds:[],timestep:[]},R=[],O=[];self.addEventListener("message",function(t){switch(t=t.data,t.type){case"read":h=t.file,v=t.n_dims,n({type:"prep_timeseries"}),a();break;case"timeseries":n({type:"timeseries",node_number:t.node_number}),L.finished&&!k&&e();break;case"timestep":n({type:"timestep",index:t.index}),L.finished&&!k&&e()}})}function a(){var e="";return e+=t.toString(),e+=build_fortnd_worker.toString(),e+="build_fortnd_worker();",D(e)}function s(e){var t,n,r,o,i,a,s,c={};if(e.hasOwnProperty("data_range")&&e.hasOwnProperty("dimensions")&&e.hasOwnProperty("model_time")&&e.hasOwnProperty("model_timestep")&&e.hasOwnProperty("index")&&e.hasOwnProperty("array"))try{n=e.data_range,r=e.dimensions,o=e.index,i=e.model_time,a=e.model_timestep,s=e.num_datasets,t=new Float32Array(e.array)}catch(e){throw console.error("Error building timestep"),console.error(e.message),e}else console.error("Timestep is missing data"),console.error(e);return c.data=function(){return t},c.data_range=function(){return n},c.dimensions=function(){return r},c.index=function(e){return arguments.length?(o=e,c):o},c.model_time=function(e){return arguments.length?(i=e,c):i},c.model_timestep=function(e){return arguments.length?(a=e,c):a},c.num_datasets=function(e){return arguments.length?(s=e,c):s},c}function c(e){var t,n,r,i,c,l,u=e,f=a(),d=o();return d.timeseries=function(e,t){"function"==typeof t&&d.once("timeseries"+e,function(e){t(e)}),f.postMessage({type:"timeseries",node_number:e})},d.timestep=function(e,t){return e>=0&&e<r&&("function"==typeof t&&d.once("timestep"+e,function(e){t(e)}),f.postMessage({type:"timestep",index:e})),d},d.read=function(t){return f.postMessage({type:"read",file:t,n_dims:e}),d},f.addEventListener("message",function(e){switch(e=e.data,e.type){case"info":t=e.file_size,n=e.num_datapoints,r=e.num_datasets,i=e.num_dimensions,c=e.model_timestep,l=e.model_timestep_interval,d.dispatch({type:"info",file_size:t,num_datapoints:n,num_datasets:r,num_dimensions:i,model_timestep:c,model_timestep_interval:l});break;case"start":case"progress":d.dispatch(e);break;case"finish":d.dispatch(e),d.dispatch({type:"ready"});break;case"error":d.dispatch({type:"error",error:e.error});break;case"timeseries":var o=e.node_number,a={array:new Float32Array(e.array),data_range:e.data_range,dimensions:e.dimensions,node_number:e.node_number};d.dispatch({type:"timeseries"+o,timeseries:a}),d.dispatch({type:"timeseries",timeseries:a});break;case"timeseries_ready":d.dispatch(e);break;case"timestep":var u=s(e);d.dispatch({type:"timestep",timestep:u}),d.dispatch({type:"timestep"+u.index(),timestep:u})}}),f.postMessage({type:"n_dims",n_dims:u}),d}function l(){return c(1)}function u(){return c(2)}function f(){function e(e){return e%c}function t(t){p[e(t)]=!1,--m}function n(){return void 0===c||void 0===s?(console.error("Cache sizes not defined"),!1):!!(void 0!==i&&void 0!==a||u)||(console.error("A getter must be defined if cache is not bounded by other caches"),!1)}function r(t){p[e(t)]=!0,++m,h.is_full()&&h.dispatch({type:"ready"})}var i,a,s,c,l,u,f,d,p,g,h=o(),m=0;return h.cache_left=function(e){return arguments.length?(i=e,h):i},h.cache_right=function(e){return arguments.length?(a=e,h):a},h.contains=function(e){return e>=g&&e<g+c},h.get=function(t){if(!n())return void console.error("Cache has not been properly initialized");if(h.valid(t))return d[e(t)];if(t<0||t>=s)return void console.error(t+" is outside allowable range");if(t!==g-1){if(t!==g+c)console.error("Jumps not yet supported. Coming soon...");else if(h.shift_right())return d[e(t)]}else if(h.shift_left())return d[e(t)]},h.getter=function(e){return arguments.length?("function"==typeof e?(l=e,u=!0):console.error("Getter must be a function"),h):l},h.is_full=function(){return m===c},h.max_size=function(e){return arguments.length?(s=e,h):s},h.print=function(){console.log(d)},h.range=function(e){if(!arguments.length)return[g,g+c];if(!n())return void console.error("Cache not yet initialized. Set size and accessors before range");if(e[1]-e[0]!==c)return void console.error("Invalid range for cache of size "+c);g=e[0];for(var t=g;t<g+c;++t)i&&i.contains(t)?h.set(t,i.get(t)):a&&a.contains(t)?h.set(t,a.get(t)):l(t,h.set);return h},h.set=function(t,n){h.contains(t)?(d[e(t)]=f(e(t),n),r(t)):console.warn("Dataset "+t+" does not fall into the cache range")},h.size=function(e){return arguments.length?(c=e,d&&console.warn("Warning: Resizing cache, all data will be lost"),d=new Array(c),p=new Array(c).fill(!1),m=0,h):c},h.transform=function(e){return arguments.length?("function"==typeof e&&(f=e),h):f},h.shift_left=function(){var e,n=g-1;return!(n<0)&&(i&&(g===i.range()[1]?e=i.take_right():i.valid(n)&&(e=i.get(n))),a&&(g+c===a.range()[0]?i&&a.range()[0]!==i.range()[1]&&a.shift_left():a.valid(n)&&(e=a.get(n))),!(void 0===e&&!u)&&(g=n,t(g),void 0!==e?h.set(n,e):l(n,h.set),!0))},h.shift_right=function(){var e,n=g+c;return!(n>=s)&&(a&&(n===a.range()[0]?e=a.take_left():a.valid(n)&&(e=a.get(n))),i&&(g===i.range()[1]?a&&a.range()[0]!==i.range()[1]&&i.shift_right():i.valid(n)&&(e=i.get(n))),!(void 0===e&&!u)&&(g+=1,t(n),a?h.set(n,e):l(n,h.set),!0))},h.take_left=function(){var t,n=g;return p[e(n)]&&(t=d[e(n)],h.shift_right()),t},h.take_right=function(){var t,n=g+c-1;return p[e(n)]&&(t=d[e(n)],h.shift_left()),t},h.valid=function(t){return h.contains(t)&&p[e(t)]},f=function(e,t){return t},l=function(){console.error("A getter has not been defined for this cache.")},h}function d(e,t){function n(e){d.dispatch({type:"timestep",timestep:e})}function r(e){var t=h.get(e);void 0!==t&&(s=t.index(),n(t))}function i(e){l=e.num_datasets,p.once("ready",function(){h.once("ready",function(e){r(0),d.dispatch(e)}).max_size(e.num_datasets).range([0,1])}).max_size(e.num_datasets).range([0,t]),g.max_size(e.num_datasets).range([t,2*t]),d.dispatch(e)}function a(e,t){u.timestep(e,function(e){t(e.timestep.index(),e.timestep)})}var s,l,u=c(e),d=o(),p=f().size(t).getter(a),g=f().size(t).getter(a),h=f().size(1).cache_left(p).cache_right(g);return u.on("start",d.dispatch),u.on("progress",d.dispatch),u.on("finish",d.dispatch),u.on("info",i),d.next_timestep=function(){void 0!==s&&s+1<l&&r(s+1)},d.open=function(e){return u.read(e),d},d.previous_timestep=function(){void 0!==s&&s-1>=0&&r(s-1)},d.timeseries=function(e,t){return u.timeseries(e,t)},d.timestep=function(e){return h.get(e)},d}function p(e){return d(1,e)}function g(e){return d(2,e)}function h(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":r=e.getExtension("WEBGL_compressed_texture_etc1");break;default:r=e.getExtension(n)}return null===r&&console.warn("WebGL: "+n+" extension not supported."),t[n]=r,r}}}function m(e){return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}function _(){function e(){for(var e=0;e<16;++e)n[e]=r[e];return n}function t(){for(var e=0;e<16;++e)r[e]=n[e];return r}var n=new Float32Array(16).fill(0),r=new Float32Array(16);return n[0]=n[5]=n[10]=n[15]=1,n.identity=function(){return n.fill(0),n[0]=n[5]=n[10]=n[15]=1,n},n.ortho=function(e,t,r,o,i,a){return n[0]=2/(t-e),n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/(o-r),n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=-1/(a-i),n[11]=0,n[12]=(t+e)/(e-t),n[13]=(o+r)/(r-o),n[14]=-i/(i-a),n[15]=1,n},n.scale=function(t,o,i){return r[0]=t*n[0],r[1]=t*n[1],r[2]=t*n[2],r[3]=t*n[3],r[4]=o*n[4],r[5]=o*n[5],r[6]=o*n[6],r[7]=o*n[7],r[8]=i*n[8],r[9]=i*n[9],r[10]=i*n[10],r[11]=i*n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],e(),n},n.translate=function(o,i,a){return t(),r[12]=n[0]*o+n[4]*i+n[8]*a+n[12],r[13]=n[1]*o+n[5]*i+n[9]*a+n[13],r[14]=n[2]*o+n[6]*i+n[10]*a+n[14],r[15]=n[3]*o+n[7]*i+n[11]*a+n[15],e()},n}function v(e){e=e||Object.create(null);var t={},n={};return e.on=function(n,r){return arguments.length?1===arguments.length?t[n]:(void 0===t[n]&&(t[n]=[]),-1===t[n].indexOf(r)&&t[n].push(r),e):e},e.once=function(t,r){return arguments.length?1===arguments.length?n[t]:(void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(r)&&n[t].push(r),e):e},e.off=function(r,o){var i,a=t[r],s=n[r];return void 0!==a&&-1!==(i=a.indexOf(o))&&a.splice(i,1),void 0!==s&&-1!==(i=s.indexOf(o))&&s.splice(i,1),e},e.dispatch=function(r){var o,i,a=t[r.type],s=n[r.type],c=[];if(void 0!==a){for(void 0===r.target&&(r.target=e),i=a.length,o=0;o<i;o++)c[o]=a[o];for(o=0;o<i;o++)c[o].call(e,r)}if(void 0!==s){for(void 0===r.target&&(r.target=e),i=s.length,o=0;o<i;o++)c[o]=s[o];for(o=0;o<i;o++)c[o].call(e,r);n[r.type]=[]}return e},e}function y(e){function t(){(i()||E)&&(E=!1,o()),requestAnimationFrame(t)}function n(){var e=d3.mouse(this),t=d3.zoomTransform(u),n=t.invert(e);n[1]=g-n[1],c.dispatch({type:"click",coordinates:n,mouse:e,transform:t,offset_y:g})}function r(){var e=d3.mouse(this),t=d3.zoomTransform(u).invert([e[0],e[1]]);t[1]=g-t[1],c.dispatch({type:"hover",coordinates:t})}function o(){d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);for(var e=0;e<F.length;++e)F[e].render()}function i(){return(u.clientWidth!==y||u.clientHeight!==x)&&(y=u.clientWidth,x=u.clientHeight,u.width=y*b,u.height=x*b,d.viewport(0,0,y,x),(!g||g<0)&&(g=x),a(),!0)}function a(e,t,n){if(!arguments.length){var r=d3.zoomTransform(u);return a(r.k,r.x,r.y)}A.ortho(0,y,x,0,-1e4,1e4).translate(t,n,0).scale(e,-e,1).translate(0,-g,0);for(var o=0;o<F.length;++o)F[o].shader().projection(A);c.dispatch({type:"projection",transform:d3.zoomTransform(u)})}function s(){var e=d3.event.transform;a(e.k,e.x,e.y),c.render()}var c=v(),l=e,u=e.node();if(m(u)){var f={alpha:!1,antialias:!1,premultiplieAlpha:!1,stencil:!0},d=u.getContext("webgl",f)||u.getContext("experimental-webgl",f);if(null!==d){var p=h(d);p.get("ANGLE_instanced_arrays"),p.get("OES_element_index_uint"),p.get("OES_standard_derivatives");var g,y=0,x=0,b=1,w=d3.color("white"),A=_(),k=d3.zoom().on("zoom",s);l.call(k).on("mousemove",r).on("click",n);var E=!0,F=[];return c.add_view=function(e){return e.on("update",c.render),F.push(e),a(),c},c.clear_color=function(e){return arguments.length?(w=d3.rgb.apply(w,arguments),d.clearColor(w.r/255,w.g/255,w.b/255,w.opacity),c.render()):w},c.gl_context=function(){return d},c.remove_view=function(e){return e.off("update",c.render),c},c.render=function(){return E=!0,c},c.set_view=function(e){return e.on("update",c.render),F=[e],a(),c},c.zoom_to=function(e){if(!arguments.length)return c;var t=e.bounding_box(),n=0,r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],i=(t[0][0]+t[1][0])/2,a=x-(t[0][1]+t[1][1])/2,s=.9/Math.max(r/y,o/x),u=[y/2-s*i,x/2-s*a];return 2==arguments.length&&(n=arguments[1]),l.transition().duration(n).call(k.transform,d3.zoomIdentity.translate(u[0],u[1]).scale(s)),c},u.addEventListener("webglcontextlost",c.dispatch),u.addEventListener("webglcontextrestored",c.dispatch),u.addEventListener("webglcontextcreationerror",c.dispatch),t(),c}}}function x(e,t){function n(e){for(var t=new Float32Array(3*a),n=0;n<a;++n){var r=e[n];t[3*n]=r,t[3*n+1]=r,t[3*n+2]=r}var i=l.get("vertex_value");o.bindBuffer(o.ARRAY_BUFFER,i.buffer),o.bufferSubData(o.ARRAY_BUFFER,0,t)}function r(e){for(var t=new Float32Array(3*a),n=i.nodes().map,r=i.elements().array,s=0;s<3*a;++s){var c=r[s],u=n.get(c);t[s]=e[u]}var f=l.get("vertex_value");o.bindBuffer(o.ARRAY_BUFFER,f.buffer),o.bufferSubData(o.ARRAY_BUFFER,0,t)}var o=e,i=t,a=0,s=0,c=1,l=d3.map(),u=v();return u.bind_buffer=function(e){var t=l.get(e);if(t)return o.bindBuffer(o.ARRAY_BUFFER,t.buffer),t},u.bounding_box=function(){var e=i.bounding_box(),t=e[0][0],n=e[0][1],r=e[1][0],o=e[1][1];return[[c*t,c*n],[c*r,c*o]]},u.draw_arrays=function(){o.drawArrays(o.TRIANGLES,0,3*a)},u.elemental_value=function(e){var t=i.elemental_value(e);t&&(n(t),u.dispatch({type:"update",value:e}))},u.nodal_value=function(e){var t=i.nodal_value(e);t&&(r(t),u.dispatch({type:"update",value:e}))},function(e,n){var r=t.bounding_box();Math.min(r[1][0]-r[0][0],r[1][1]-r[0][1]);s=n.array.length,a=n.array.length/3;for(var i=new Float32Array(2*s),u=new Float32Array(s),f=new Float32Array(3*s),d=e.dimensions,p=0;p<s;++p){var g=n.array[p],h=e.map.get(g);i[2*p]=e.array[d*h]*c,i[2*p+1]=e.array[d*h+1]*c}for(var p=0;p<a;++p)f[9*p]=1,f[9*p+4]=1,f[9*p+8]=1;var m=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,m),o.bufferData(o.ARRAY_BUFFER,i,o.STATIC_DRAW);var _=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,_),o.bufferData(o.ARRAY_BUFFER,u,o.DYNAMIC_DRAW);var v=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,v),o.bufferData(o.ARRAY_BUFFER,f,o.STATIC_DRAW),l.set("vertex_position",{buffer:m,size:2,type:o.FLOAT,normalized:!1,stride:0,offset:0}),l.set("vertex_value",{buffer:_,size:1,type:o.FLOAT,normalized:!1,stride:0,offset:0}),l.set("vertex_normal",{buffer:v,size:3,type:o.FLOAT,normalized:!1,stride:0,offset:0})}(i.nodes(),i.elements()),u}function b(e,t,n){var r=e,o=t,i=n,a=v();return a.elemental_value=function(e){return o.elemental_value(e),a},a.nodal_value=function(e){return o.nodal_value(e),a},a.render=function(){return i.use(),i.attributes().each(function(e,t){var n=o.bind_buffer(t);"undefined"!==n&&(r.vertexAttribPointer(e,n.size,n.type,n.normalized,n.stride,n.offset),r.enableVertexAttribArray(e))}),o.draw_arrays(),a},a.shader=function(e){return arguments.length?(e.projection(i.projection()),i=e,a.dispatch({type:"update"}),a):i},o.on("update",a.dispatch),a}function w(e,t,n,r,o){var i=e.createShader(t);if(e.shaderSource(i,n),e.compileShader(i),!1===e.getShaderParameter(i,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(i);return o||(o=console.error),o("Unable to compile shader"),o(a),void e.deleteShader(i)}return!1===e.getShaderParameter(i,e.COMPILE_STATUS)&&(r||(r=console.warn),r(e.getShaderInfoLog(i),A(n))),i}function A(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}function k(e,t,n,r,o){var i=e.createProgram(),a=w(e,e.VERTEX_SHADER,t,r,o),s=w(e,e.FRAGMENT_SHADER,n,r,o);if(i&&a&&s)return e.attachShader(i,a),e.attachShader(i,s),e.linkProgram(i),!1===e.getProgramParameter(i,e.LINK_STATUS)&&(o||(o=console.error),o(e.getProgramInfoLog(i))),e.deleteShader(a),e.deleteShader(s),i}function E(e){var t=e,n=k(t,F(),L()),r=d3.color("white"),o=d3.color("black"),i=.3,a=1;t.useProgram(n);var s=d3.map({vertex_normal:t.getAttribLocation(n,"vertex_normal"),vertex_position:t.getAttribLocation(n,"vertex_position")}),c=d3.map({face_color:t.getUniformLocation(n,"face_color"),projection_matrix:t.getUniformLocation(n,"projection_matrix"),wire_alpha:t.getUniformLocation(n,"wire_alpha"),wire_color:t.getUniformLocation(n,"wire_color"),wire_width:t.getUniformLocation(n,"wire_width")});return n.attribute=function(e){return s.get(e)},n.attributes=function(e){return arguments.length?(s.each(e),n):s},n.face_color=function(e){return arguments.length?(r=e,t.useProgram(n),t.uniform3fv(n.uniform("face_color"),[e.r/255,e.g/255,e.b/255]),n):r},n.set_projection=function(e){return t.useProgram(n),t.uniformMatrix4fv(n.uniform("projection_matrix"),!1,e),n},n.wire_alpha=function(e){return arguments.length?(i=e,t.useProgram(n),t.uniform1f(n.uniform("wire_alpha"),e),n):i},n.wire_color=function(e){return arguments.length?(o=e,t.useProgram(n),t.uniform3fv(n.uniform("wire_color"),[e.r/255,e.g/255,e.b/255]),n):o},n.wire_width=function(e){return arguments.length?(a=e,t.useProgram(n),t.uniform1f(n.uniform("wire_width"),e),n):a},n.uniform=function(e){return c.get(e)},n.uniforms=function(){return c.keys()},n.use=function(){return t.useProgram(n),n},n.face_color(n.face_color()).wire_alpha(n.wire_alpha()).wire_color(n.wire_color()).wire_width(n.wire_width())}function F(){return["attribute vec3 vertex_position;","attribute vec3 vertex_normal;","uniform mat4 projection_matrix;","varying vec3 _vertex_normal;","void main( void ) {","   gl_Position = projection_matrix * vec4( vertex_position, 1.0 );","   _vertex_normal = vertex_normal;","}"].join("\n")}function L(){return["#extension GL_OES_standard_derivatives : enable","precision highp float;","varying vec3 _vertex_normal;","uniform vec3 face_color;","uniform vec3 wire_color;","uniform float wire_alpha;","uniform float wire_width;","float edgeFactorTri() {","   vec3 d = fwidth( _vertex_normal.xyz );","   vec3 a3 = smoothstep( vec3( 0.0 ), d * wire_width, _vertex_normal.xyz );","   return min( min( a3.x, a3.y ), a3.z );","}","void main() {","   vec4 wire = mix( vec4(face_color, 1.0), vec4(wire_color, 1.0), wire_alpha);","   if ( wire_width == 0.0 ) {","       gl_FragColor = vec4(_vertex_color, 1.0);","   } else {","       gl_FragColor = mix( wire, vec4(_vertex_color, 1.0), edgeFactorTri() );","   }","}"].join("\n")}function z(e,t,n,r){function o(e,t,n){for(var r=[],o=0;o<n;++o)r.push(e+(t-e)*o/(n-1));return r}t=t>1?t:2;for(var i,a=e,s=k(a,R(t),O()),c=[],l=[],u=d3.color("black"),f=.3,d=1,n=n||0,r=r||1,p=0;p<t;++p)l.push(n+(r-n)*p/(t-1)),c.push(d3.color(d3.schemeCategory20[p%t]));a.useProgram(s);var g=d3.map({vertex_normal:a.getAttribLocation(s,"vertex_normal"),vertex_position:a.getAttribLocation(s,"vertex_position"),vertex_value:a.getAttribLocation(s,"vertex_value")}),h=d3.map({gradient_colors:a.getUniformLocation(s,"gradient_colors"),gradient_stops:a.getUniformLocation(s,"gradient_stops"),projection_matrix:a.getUniformLocation(s,"projection_matrix"),wire_alpha:a.getUniformLocation(s,"wire_alpha"),wire_color:a.getUniformLocation(s,"wire_color"),wire_width:a.getUniformLocation(s,"wire_width")});return s.attribute=function(e){return g.get(e)},s.attributes=function(e){return arguments.length?(g.each(e),s):g},s.gradient_colors=function(e){if(!arguments.length)return c;c=e;var t=c.map(function(e){return[e.r/255,e.g/255,e.b/255]}).reduce(function(e,t){return e.concat(t)},[]);return a.useProgram(s),a.uniform3fv(s.uniform("gradient_colors"),t),s},s.gradient_stops=function(e){return arguments.length?(2==e.length&&2!==t&&(e=o(e[0],e[1],t)),l=e,a.useProgram(s),a.uniform1fv(s.uniform("gradient_stops"),l),s):l},s.projection=function(e){return arguments.length?(i=e,a.useProgram(s),a.uniformMatrix4fv(s.uniform("projection_matrix"),!1,e),s):i},s.wire_alpha=function(e){return arguments.length?(f=e,a.useProgram(s),a.uniform1f(s.uniform("wire_alpha"),e),s):f},s.wire_color=function(e){return arguments.length?(u=e,a.useProgram(s),a.uniform3fv(s.uniform("wire_color"),[e.r/255,e.g/255,e.b/255]),s):u},s.wire_width=function(e){return arguments.length?(d=e,a.useProgram(s),a.uniform1f(s.uniform("wire_width"),e),s):d},s.uniform=function(e){return h.get(e)},s.uniforms=function(){return h.keys()},s.use=function(){return a.useProgram(s),s},s.gradient_colors(s.gradient_colors()).gradient_stops(s.gradient_stops()).wire_alpha(s.wire_alpha()).wire_color(s.wire_color()).wire_width(s.wire_width())}function R(e){for(var t=["attribute vec2 vertex_position;","attribute vec3 vertex_normal;","attribute float vertex_value;","uniform mat4 projection_matrix;","uniform float gradient_stops["+e+"];","uniform vec3 gradient_colors["+e+"];","varying vec3 _vertex_normal;","varying vec3 _vertex_color;","void main() {","  gl_Position = projection_matrix * vec4( vertex_position, vertex_value, 1.0 );","  _vertex_normal = vertex_normal;","  _vertex_color = gradient_colors[0];","  float t;"],n=1;n<e;++n)t.push("  t = clamp((vertex_value - gradient_stops["+(n-1)+"]) / (gradient_stops["+n+"]-gradient_stops["+(n-1)+"]), 0.0, 1.0);"),t.push("  _vertex_color = mix( _vertex_color, gradient_colors["+n+"], t*t*(3.0-2.0*t));");return t.push("}"),t.join("\n")}function O(){return["#extension GL_OES_standard_derivatives : enable","precision mediump float;","varying vec3 _vertex_normal;","varying vec3 _vertex_color;","uniform vec3 wire_color;","uniform float wire_alpha;","uniform float wire_width;","float edgeFactorTri() {","   vec3 d = fwidth( _vertex_normal.xyz );","   vec3 a3 = smoothstep( vec3( 0.0 ), d * wire_width, _vertex_normal.xyz );","   return min( min( a3.x, a3.y ), a3.z );","}","void main() {","   vec4 wire = mix( vec4(_vertex_color, 1.0), vec4(wire_color, 1.0), wire_alpha);","   if ( wire_width == 0.0 ) {","       gl_FragColor = vec4(_vertex_color, 1.0);","   } else {","       gl_FragColor = mix( wire, vec4(_vertex_color, 1.0), edgeFactorTri() );","   }","}"].join("\n")}function B(e){e=e||Object.create(null);var t={},n={};return e.on=function(n,r){return arguments.length?1===arguments.length?t[n]:(void 0===t[n]&&(t[n]=[]),-1===t[n].indexOf(r)&&t[n].push(r),e):e},e.once=function(t,r){return arguments.length?1===arguments.length?n[t]:(void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(r)&&n[t].push(r),e):e},e.off=function(r,o){var i,a=t[r],s=n[r];return void 0!==a&&-1!==(i=a.indexOf(o))&&a.splice(i,1),void 0!==s&&-1!==(i=s.indexOf(o))&&s.splice(i,1),e},e.dispatch=function(r){var o,i,a=t[r.type],s=n[r.type],c=[];if(void 0!==a){for(void 0===r.target&&(r.target=e),i=a.length,o=0;o<i;o++)c[o]=a[o];for(o=0;o<i;o++)c[o].call(e,r)}if(void 0!==s){for(void 0===r.target&&(r.target=e),i=s.length,o=0;o<i;o++)c[o]=s[o];for(o=0;o<i;o++)c[o].call(e,r);n[r.type]=[]}return e},e}function I(){function e(e){return e%s}function t(t){d[e(t)]=!1,--h}function n(){return void 0===s||void 0===a?(console.error("Cache sizes not defined"),!1):!!(void 0!==o&&void 0!==i||l)||(console.error("A getter must be defined if cache is not bounded by other caches"),!1)}function r(t){d[e(t)]=!0,++h,g.is_full()&&g.dispatch({type:"ready"})}var o,i,a,s,c,l,u,f,d,p,g=B(),h=0;return g.cache_left=function(e){return arguments.length?(o=e,g):o},g.cache_right=function(e){return arguments.length?(i=e,g):i},g.contains=function(e){return e>=p&&e<p+s},g.get=function(t){if(!n())return void console.error("Cache has not been properly initialized");if(g.valid(t))return f[e(t)];if(t<0||t>=a)return void console.error(t+" is outside allowable range");if(t!==p-1){if(t!==p+s)console.error("Jumps not yet supported. Coming soon...");else if(g.shift_right())return f[e(t)]}else if(g.shift_left())return f[e(t)]},g.getter=function(e){return arguments.length?("function"==typeof e?(c=e,l=!0):console.error("Getter must be a function"),g):c},g.is_full=function(){return h===s},g.max_size=function(e){return arguments.length?(a=e,g):a},g.print=function(){console.log(f)},g.range=function(e){if(!arguments.length)return[p,p+s];if(!n())return void console.error("Cache not yet initialized. Set size and accessors before range");if(e[1]-e[0]!==s)return void console.error("Invalid range for cache of size "+s);p=e[0]
;for(var t=p;t<p+s;++t)o&&o.contains(t)?g.set(t,o.get(t)):i&&i.contains(t)?g.set(t,i.get(t)):c(t,g.set);return g},g.set=function(t,n){g.contains(t)?(f[e(t)]=u(e(t),n),r(t)):console.warn("Dataset "+t+" does not fall into the cache range")},g.size=function(e){return arguments.length?(s=e,f&&console.warn("Warning: Resizing cache, all data will be lost"),f=new Array(s),d=new Array(s).fill(!1),h=0,g):s},g.transform=function(e){return arguments.length?("function"==typeof e&&(u=e),g):u},g.shift_left=function(){var e,n=p-1;return!(n<0)&&(o&&(p===o.range()[1]?e=o.take_right():o.valid(n)&&(e=o.get(n))),i&&(p+s===i.range()[0]?o&&i.range()[0]!==o.range()[1]&&i.shift_left():i.valid(n)&&(e=i.get(n))),!(void 0===e&&!l)&&(p=n,t(p),void 0!==e?g.set(n,e):c(n,g.set),!0))},g.shift_right=function(){var e,n=p+s;return!(n>=a)&&(i&&(n===i.range()[0]?e=i.take_left():i.valid(n)&&(e=i.get(n))),o&&(p===o.range()[1]?i&&i.range()[0]!==o.range()[1]&&o.shift_right():o.valid(n)&&(e=o.get(n))),!(void 0===e&&!l)&&(p+=1,t(n),i?g.set(n,e):c(n,g.set),!0))},g.take_left=function(){var t,n=p;return d[e(n)]&&(t=f[e(n)],g.shift_right()),t},g.take_right=function(){var t,n=p+s-1;return d[e(n)]&&(t=f[e(n)],g.shift_left()),t},g.valid=function(t){return g.contains(t)&&d[e(t)]},u=function(e,t){return t},c=function(){console.error("A getter has not been defined for this cache.")},g}function S(e){e=e||Object.create(null);var t={},n={};return e.on=function(n,r){return arguments.length?1===arguments.length?t[n]:(void 0===t[n]&&(t[n]=[]),-1===t[n].indexOf(r)&&t[n].push(r),e):e},e.once=function(t,r){return arguments.length?1===arguments.length?n[t]:(void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(r)&&n[t].push(r),e):e},e.off=function(r,o){var i,a=t[r],s=n[r];return void 0!==a&&-1!==(i=a.indexOf(o))&&a.splice(i,1),void 0!==s&&-1!==(i=s.indexOf(o))&&s.splice(i,1),e},e.dispatch=function(r){var o,i,a=t[r.type],s=n[r.type],c=[];if(void 0!==a){for(void 0===r.target&&(r.target=e),i=a.length,o=0;o<i;o++)c[o]=a[o];for(o=0;o<i;o++)c[o].call(e,r)}if(void 0!==s){for(void 0===r.target&&(r.target=e),i=s.length,o=0;o<i;o++)c[o]=s[o];for(o=0;o<i;o++)c[o].call(e,r);n[r.type]=[]}return e},e}function T(e){e=e||Object.create(null);var t={},n={};return e.on=function(n,r){return arguments.length?1===arguments.length?t[n]:(void 0===t[n]&&(t[n]=[]),-1===t[n].indexOf(r)&&t[n].push(r),e):e},e.once=function(t,r){return arguments.length?1===arguments.length?n[t]:(void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(r)&&n[t].push(r),e):e},e.off=function(r,o){var i,a=t[r],s=n[r];return void 0!==a&&-1!==(i=a.indexOf(o))&&a.splice(i,1),void 0!==s&&-1!==(i=s.indexOf(o))&&s.splice(i,1),e},e.dispatch=function(r){var o,i,a=t[r.type],s=n[r.type],c=[];if(void 0!==a){for(void 0===r.target&&(r.target=e),i=a.length,o=0;o<i;o++)c[o]=a[o];for(o=0;o<i;o++)c[o].call(e,r)}if(void 0!==s){for(void 0===r.target&&(r.target=e),i=s.length,o=0;o<i;o++)c[o]=s[o];for(o=0;o<i;o++)c[o].call(e,r);n[r.type]=[]}return e},e}function U(){function e(t){return c=t.style("position","relative").style("width","100%").style("margin-top","4px").style("margin-bottom","4px").style("user-select","none"),l=c.selectAll("div").data(["slider_bar"]),l.exit().remove(),l=l.enter().append("div").merge(l),l.style("position","relative").style("left",0).style("width","1px").style("background-clip","content-box").style("margin","-4px").style("border-width","4px").style("border-style","solid").style("user-select","none"),u=c.node().getBoundingClientRect().width,F.domain([0,u]),c.on("mousedown",n).on("wheel",a),e.arrows(f),e.bar(d),e.color(p),e.domain(A),e.draggable(v),e.height(h),e.jumpable(y),e}function t(e){var t=E.domain();return e<t[0]?t[0]:e>t[1]?t[1]:e}function n(){if(y){var e=d3.mouse(this)[0];e<0&&(e=0),e>u&&(e=u);s(F(e))&&r()}}function r(){e.dispatch({type:"value",value:g})}function o(t){var n=g;t>g&&(n+=w),t<g&&(n-=w),n!==g&&e.dispatch({type:"request",value:n})}function i(){if(v){var e=d3.event.x;e<0&&(e=0),e>u&&(e=u);var t=F(e);x?o(t):s(t)&&r()}}function a(){if(v){var t=d3.event.shiftKey?10*w:w,n=d3.event.deltaX<0||d3.event.deltaY<0?1:-1;s(e.current()+t*n)&&r()}}function s(e){return(e=b?t(e):k(e))!==g&&(g=y?e:e>g?g+w:g-w,l&&l.style("left",E(g)+"%"),!0)}var c,l,u,f="both",d="dimgray",p="lightgray",g=0,h=20,m=d3.drag().on("drag",i),_=d3.drag().on("start",n).on("drag",i),v=!0,y=!0,x=!1,b=!1,w=1,A=[0,100],k=d3.scaleQuantize(),E=d3.scaleLinear().range([0,100]).clamp(!0),F=d3.scaleLinear();return e.arrows=function(t){if(!arguments.length)return f;if(("top"==t||"bottom"==t||"both"==t||"none"==t)&&(f=t,l))switch(f){case"both":l.style("border-color",d+" transparent "+d+" transparent");break;case"top":l.style("border-color",d+" transparent transparent transparent");break;case"bottom":l.style("border-color","transparent transparent "+d+" transparent");break;default:l.style("border-color","transparent transparent transparent transparent")}return e},e.bar=function(t){return arguments.length?(d=t,l&&(l.style("background-color",d),e.arrows(f)),e):d},e.color=function(t){return arguments.length?(p=t,c&&c.style("background-color",p),e):p},e.continuous=function(t){return arguments.length?(b=!!t,e):b},e.current=function(t){return arguments.length?(s(t),e):g},e.domain=function(t){if(!arguments.length)return E.domain();A=t;var n=[];w=2==arguments.length?arguments[1]:1;for(var r=t[0];r<=t[1];r+=w)n.push(r);return k.domain(t).range(n),E.domain(t),F.range(t),e},e.draggable=function(t){return arguments.length?(v=!!t,l&&(v?l.style("cursor","pointer").call(m):l.style("cursor",null).on(".drag",null)),e):v},e.height=function(t){return arguments.length?(h=t,c&&c.style("min-height",h+"px"),l&&l.style("min-height",h+"px"),e):h},e.jumpable=function(t){return arguments.length?(y=!!t,c&&(y?c.style("cursor","pointer").call(_):c.style("cursor",null).on(".drag",null)),e):y},e.needs_request=function(t){return arguments.length?(x=!!t,e):x},e.set=function(e){s(e)},T(e)}function P(){function e(n){return t=n,e.file_picker(r),e}var t,n,r;return e.file_picker=function(o){return arguments.length?"function"!=typeof o?e:(r=o,!n&&t&&(n=t.append("input").attr("type","file").style("display","none").on("click",function(){d3.event.stopPropagation()}).on("change",function(){"function"==typeof r&&r(n.node().files[0])})),t&&t.on("click",function(){d3.event.preventDefault(),n.node().click()}),e):n},e}function j(){function e(r){return t=r.style("position","relative").style("width","100%").style("user-select","none"),n=t.selectAll("div").data(["progress_bar"]),n.exit().remove(),n=n.enter().append("div").merge(n),n.style("position","relative").style("left",0).style("width","0%").style("background-clip","content-box").style("user-select","none"),e.background_color(i),e.color(a),e.height(o),e}var t,n,r=0,o=10,i="lightgray",a="steelblue",s=d3.scaleLinear().domain([0,100]).range([0,100]).clamp(!0);return e.background_color=function(n){return arguments.length?(i=n,t&&t.style("background-color",i),e):i},e.color=function(t){return arguments.length?(a=t,n&&n.style("background-color",a),e):a},e.height=function(r){return arguments.length?(o=r,t&&t.style("min-height",o+"px"),n&&n.style("min-height",o+"px"),e):o},e.progress=function(t){return arguments.length?(r=s(t),n&&n.style("width",r+"%"),e):r},e}function M(){function e(t){return s=t,r(s),e}function t(e){for(var t="linear-gradient( 0deg, ",n=0;n<e.length;++n){t+=e[n].color+" "+100*e[n].stop+"%",n<e.length-1&&(t+=",")}return t+")"}function n(n){var r=Math.max(0,Math.min(p,d3.event.y));d3.select(this).style("top",r+"px"),n.stop=m.invert(r);var o=g.sort(i);c.style("background",t(o)),u.each(a),e.dispatch({type:"gradient",stops:o.map(function(e){return h(e.stop)}),colors:o.map(function(e){return e.color})})}function r(e){e.style("position","relative").style("width",f+d+"px").style("user-select","none").style("min-height",p+"px"),c=e.selectAll(".gradient-bar").data([{}]),c.exit().remove(),c=c.enter().append("div").attr("class","gradient-bar").merge(c),c.style("position","absolute").style("top",0).style("left",0).style("width",f+"px").style("height","100%").style("background",t(g)).style("user-select","none"),l=e.selectAll(".gradient-track").data([{}]),l.exit().remove(),l=l.enter().append("div").attr("class","gradient-track").merge(l),l.style("position","absolute").style("top",0).style("left",f+"px").style("width",d+"px").style("height","100%").style("user-select","none"),o()}function o(){u=l.selectAll(".slider").data(g),u.exit().remove(),u=u.enter().append("div").attr("class","slider").merge(u),u.style("width","0px").style("height","1px").style("border-width","8px").style("border-style","solid").style("margin-top","-8px").style("margin-left","-8px").style("position","absolute").style("left",0).each(function(e){d3.select(this).style("top",p-e.stop*p+"px").style("border-color","transparent "+e.color+" transparent transparent").style("user-select","none")}).each(a).call(d3.drag().on("drag",n))}function i(e,t){return e.stop>t.stop}function a(e){var t=d3.select(this).selectAll("div").data([{}]);t.exit().remove(),t=t.enter().append("div").merge(t),t.style("position","absolute").style("top","50%").style("left","8px").style("transform","translateY(-50%)").style("padding-left","4px").style("font-size","13px").style("font-family","serif").style("min-width",d-12+"px").style("user-select","none").style("cursor","default").text(h(e.stop).toFixed(5))}var s,c,l,u,f=50,d=75,p=250,g=[{stop:0,color:"lightsteelblue"},{stop:1,color:"steelblue"}],h=d3.scaleLinear().domain([0,1]).range([0,1]),m=d3.scaleLinear().domain([0,1]).range([p,0]);return e.stops=function(t,n){var o=d3.extent(t);h.range(o),g=[];for(var a=0;a<t.length;++a)g.push({stop:h.invert(t[a]),color:n[a]});return g=g.sort(i),r(s),e},T(e)}function W(e){function t(e){return e.append("div").style("display","flex").style("flex-direction","column")}function n(e){return!e||!!o[e]}function r(){console.error("All UI components must have a unique ID")}var o=Object.create(null);return e.selectAll(".adc-slider").each(function(){var e=d3.select(this),i=e.attr("id");if(n(i))return r();o[i]=U()(t(e))}),e.selectAll(".adc-button").each(function(){var e=d3.select(this),t=e.attr("id");if(n(t))return r();o[t]=P()(e)}),e.selectAll(".adc-progress").each(function(){var e=d3.select(this),t=e.attr("id");if(n(t))return r();o[t]=j()(e)}),e.selectAll(".adc-gradient").each(function(){var e=d3.select(this),t=e.attr("id");if(n(t))return r();o[t]=M()(e)}),o}function C(){function e(e){for(var o=e.names?Math.min(e.names.length,e.dimensions)-2:0,i=e.array.length/e.dimensions,a=[new Float32Array(2*i)],s=0;s<o;++s)a.push(new Float32Array(i));for(var c=0;c<i;++c){a[0][2*c]=e.array[e.dimensions*c],a[0][2*c+1]=e.array[e.dimensions*c+1];for(var l=0;l<o;++l)a[1+l][c]=e.array[e.dimensions*c+2+l]}r={array:a[0],map:e.map,dimensions:2,names:["x","y"]};for(var l=0;l<o;++l){var u=e.names[2+l];n.nodal_value(u,a[1+l])}t=G(r)}var t,n=S(),r=Object.create({array:[],map:d3.map(),dimensions:2}),o=Object.create({array:[],map:d3.map()}),i=d3.map(),a=d3.map();return n.bounding_box=function(){return t},n.bounds=function(e){var t=n.nodal_value(e)||n.elemental_value(e);if(t)return G({array:t,dimensions:1})},n.elemental_value=function(e,t){return 1==arguments.length?a.get(e):(2==arguments.length&&t.length==o.array.length/3&&(a.set(e,t),n.dispatch({type:"elemental_value",name:e,array:t})),n)},n.elemental_values=function(){return a.keys()},n.elements=function(e){return arguments.length?(e.array&&e.map&&(o=e),n.dispatch({type:"num_elements",num_elements:n.num_elements()}),n):o},n.find_node=function(e){for(var t,n,o,i=r.array.length/2,a={node_number:null,distance:1/0},s=0;s<i;++s)t=r.array[2*s],n=r.array[2*s+1],(o=function(t,n){return(t-e[0])*(t-e[0])+(n-e[1])*(n-e[1])}(t,n))<a.distance&&(a.distance=o,a.node_number=s+1,a.coordinates=[t,n]);return a},n.nodal_value=function(e,t){return 1==arguments.length?i.get(e):(2==arguments.length&&t.length==r.array.length/r.dimensions&&(i.set(e,t),n.dispatch({type:"nodal_value",name:e,array:t})),n)},n.nodal_values=function(){return i.keys()},n.nodes=function(o){return arguments.length?(o.array&&o.map&&o.dimensions&&e(o),n.dispatch({type:"bounding_box",bounding_box:t}),n.dispatch({type:"num_nodes",num_nodes:n.num_nodes()}),n):r},n.num_elements=function(){return o.array.length/3},n.num_nodes=function(){return r.array.length/r.dimensions},n}function G(e){for(var t=e.array,n=e.dimensions,r=t.length/n,o=[],i=[],a=0;a<n;++a)o.push(1/0),i.push(-1/0);for(var s=0;s<r;++s)for(var c=0;c<n;++c)-99999!==t[n*s+c]&&(t[n*s+c]<o[c]&&(o[c]=t[n*s+c]),t[n*s+c]>i[c]&&(i[c]=t[n*s+c]));return 1==n?[o[0],i[0]]:[o,i]}var D=function(e){var t=URL.createObjectURL(new Blob([e],{type:"application/javascript"})),n=new Worker(t);return URL.revokeObjectURL(t),n};e.fort14=i,e.fort63=l,e.fort64=u,e.fort63_cached=p,e.fort64_cached=g,e.gl_renderer=y,e.geometry=x,e.view=b,e.basic_shader=E,e.gradient_shader=z,e.cache=I,e.dispatcher=S,e.slider=U,e.button=P,e.progress=j,e.gradient=M,e.ui=W,e.mesh=C,Object.defineProperty(e,"__esModule",{value:!0})});